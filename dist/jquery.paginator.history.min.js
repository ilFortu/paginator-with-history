/** @preserve
 *
 * Never ending scroll with history
 *
 Version: 0.0.8
 Author: Antonio Fortunato
 Website: https://github.com/ilFortu/paginator-with-history
 Docs: https://github.com/ilFortu/paginator-with-history
 Repo: https://github.com/ilFortu/paginator-with-history
 Issues: https://github.com/ilFortu/paginator-with-history/issues
 */
!function($){function Paginator(el,options){var $el=$(el);if(this.$el=$el,this.$prev=this.$el.find(".jph-prev").length>0?this.$el.find(".jph-prev"):null,this.$next=this.$el.find(".jph-next").length>0?this.$el.find(".jph-next"):null,null!=this.$prev||null!=this.$next){var defaults={"paramPage":"page","offsetCallPage":500,"offsetAnchor":-200,"linkItem":".jph-item-link","selectorContainer":null,"blockPageHtmlElement":"div","item":".jph-item","disableHistory":!1,"ajaxDoneBeforeItemsInPage":function(){},"ajaxDoneAfterItemsInPage":function(){}};this.settings=$.extend({},defaults,options),this.$paginatorListContainer=this.$el.find(".jph-list-container"),this.ajaxUrl=this.$el.data("jph-ajax-url"),this.listItemsPage="jph-list-items-page",this.listItemsPageClass="."+this.listItemsPage,this.$currentPage=this.$el.find(this.listItemsPageClass),this.currentPage=this.$currentPage.data("page"),this.loadingPage=!1,this.arrayPagePositions=new Array,this.init(),this.moveEvents()}}Paginator.prototype.init=function(){var _this=this;this.settings.disableHistory||(null!=_this.$prev&&_this.$prev.attr("data-page")>0&&(_this.loadingPage=!0,$(window).load(function(){_this.ajaxCall(_this.$prev.attr("data-page"),!1,!0)})),this.$el.on("click",this.settings.linkItem,function(evt){console.log($(this).parents(_this.listItemsPageClass).attr("data-page")),_this.changeLocation(parseInt($(this).parents(_this.listItemsPageClass).attr("data-page")),$(this).parents(_this.settings.item).attr("id"))})),this.updateArrayPagePosition(_this.currentPage)},Paginator.prototype.moveEvents=function(){function mouseWheel(){var e=window.event||e,delta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));switch(delta){case 1:_this.moveWindow("up");break;case-1:_this.moveWindow("down")}}var _this=this;window.addEventListener("mousewheel",mouseWheel,!1),window.addEventListener("DOMMouseScroll",mouseWheel,!1),document.onkeydown=function(e){switch(e.keyCode){case 38:_this.moveWindow("up");break;case 40:_this.moveWindow("down")}};var swipeFunc={"touches":{"touchstart":{"y":-1},"touchmove":{"y":-1},"touchend":!1,"direction":"undetermined"},"touchHandler":function(event){var touch;if("undefined"!=typeof event&&"undefined"!=typeof event.touches)switch(touch=event.touches[0],event.type){case"touchstart":case"touchmove":swipeFunc.touches[event.type].y=touch.pageY;break;case"touchend":swipeFunc.touches[event.type]=!0,swipeFunc.touches.touchstart.y>-1&&swipeFunc.touches.touchmove.y>-1&&(swipeFunc.touches.direction=swipeFunc.touches.touchstart.y<swipeFunc.touches.touchmove.y?"up":"down",_this.moveWindow(swipeFunc.touches.direction))}},"init":function(){document.addEventListener("touchstart",swipeFunc.touchHandler,!1),document.addEventListener("touchmove",swipeFunc.touchHandler,!1),document.addEventListener("touchend",swipeFunc.touchHandler,!1)}};swipeFunc.init()},Paginator.prototype.moveWindow=function(direction){if(!this.loadingPage&&(!this.settings.disableHistory||this.settings.disableHistory&&"down"==direction)){var scrollPos=$(window).scrollTop();"down"==direction&&null!=this.$next&&this.$next.offset().top-this.settings.offsetCallPage<scrollPos+$(window).height()?(this.loadingPage=!0,this.ajaxCall(this.$next.attr("data-page"),!0)):"up"==direction&&null!=this.$prev&&scrollPos-this.$prev.offset().top<this.settings.offsetCallPage&&(this.loadingPage=!0,this.ajaxCall(this.$prev.attr("data-page"),!1)),this.moveWindowChangeCurrentPage()}},Paginator.prototype.moveWindowChangeCurrentPage=function(){var _this=this;$(window).scrollTop()+$(window).height()/2<this.arrayPagePositions[_this.currentPage].top?(_this.currentPage--,this.updatePagePosition(_this.currentPage)):$(window).scrollTop()+$(window).height()/2>this.arrayPagePositions[_this.currentPage].bottom&&(_this.currentPage++,this.updatePagePosition(_this.currentPage))},Paginator.prototype.updatePagePosition=function(page){this.arrayPagePositions=[],this.updateArrayPagePosition(page-1),this.updateArrayPagePosition(page),this.updateArrayPagePosition(page+1),this.changeLocation(page,null),console.log(this.arrayPagePositions)},Paginator.prototype.updateArrayPagePosition=function(page){var $page=this.$el.find(this.listItemsPageClass+"[data-page='"+page+"']");if($page.length>0){var currentPagePos={"page":page,"top":$page.find(this.settings.item).first().offset().top,"bottom":$page.find(this.settings.item).last().offset().top+$page.find(this.settings.item).last().outerHeight()};this.arrayPagePositions[page]=currentPagePos}},Paginator.prototype.ajaxCall=function(page,isNext,prevLoadOnStart){var page=parseInt(page),_this=this;$.ajax({"url":_this.setUrlwithPagination(_this.ajaxUrl,page),"context":document.body}).done(function(content){_this.settings.ajaxDoneBeforeItemsInPage.call(this);var html=content,removeLink=!1;if(null!=content&&""!=content)if(null!=_this.settings.selectorContainer&&(html=$(content).find(_this.settings.selectorContainer).html()),"undefined"!=typeof html&&""!=html){var newPageBlock="<"+_this.settings.blockPageHtmlElement+" class='jph-new-page "+_this.listItemsPage+"' data-page='"+page+"'>"+html+"</"+_this.settings.blockPageHtmlElement+">";if(isNext)_this.$paginatorListContainer.append($(newPageBlock).addClass("jph-appended")),page++,_this.$next.attr("data-page",page);else{_this.$paginatorListContainer.prepend($(newPageBlock).addClass("jph-prepended"));var scrollTo=0;if(prevLoadOnStart){var $currentBlock=_this.$paginatorListContainer.find(_this.listItemsPageClass+"[data-page='"+_this.currentPage+"']"),hash=window.location.hash.substring(1);""!=hash&&$currentBlock.find("#"+hash).length>0&&($currentBlock=$currentBlock.find("#"+hash)),scrollTo=$currentBlock.offset().top+_this.settings.offsetAnchor,_this.$paginatorListContainer.removeClass("jph-no-first-page")}else if(0!=window.pageYOffset){var heightPrevPage=_this.$paginatorListContainer.find(_this.listItemsPageClass+"[data-page='"+page+"']").height();scrollTo=window.pageYOffset+heightPrevPage}window.scrollTo(0,scrollTo),page>1?(page--,_this.$prev.attr("data-page",page)):removeLink=!0}}else removeLink=!0;else removeLink=!0;removeLink&&(isNext?(_this.$next.remove(),_this.$next=null):(_this.$prev.remove(),_this.$prev=null)),_this.loadingPage=!1,_this.updatePagePosition(_this.currentPage),_this.settings.ajaxDoneAfterItemsInPage.call(this)})},Paginator.prototype.changeLocation=function(pageNumber,itemId){var newLocation=this.setUrlwithPagination(window.location.href,pageNumber);"undefined"!=typeof itemId&&null!=itemId&&(newLocation+="#"+itemId),history.replaceState(null,null,newLocation)},Paginator.prototype.setUrlwithPagination=function(url,pageNumber){if("number"==typeof pageNumber&&pageNumber%1===0){if(url.indexOf(this.settings.paramPage+"=")<0)return url+(url.split("?")[1]?"&":"?")+this.settings.paramPage+"="+pageNumber;var regex=new RegExp("("+this.settings.paramPage+"=).*?((&)(.)*)?$");return url.replace(regex,"$1"+pageNumber+"$2")}return url},$.fn.paginatorHistory=function(options){return $(this).each(function(){var paginatorInstance=new Paginator(this,options);$(this).data("paginator-history",paginatorInstance)})}}(jQuery);
//# sourceMappingURL=jquery.paginator.history.min.js.map